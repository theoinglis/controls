angular.module("Controls").controller("AutocompleteInputController",["$scope","$filter","$timeout",function(a,b,c){var d=b("filter"),e=b("orderBy"),f=function(){a.filteredItems=e(d(a.items,a.options.selectedItemText),a.options.propName),a.noItems=0===a.filteredItems.length,h()};a.$watch("options.selectedItemText.length",function(){a.isDefined(a.options.selectedItem)&&a.options.selectedItemText===a.selectedItem[a.options.propName]||(a.selectedItem={}),f()}),a.$watch("items.length",f);var g,h=function(){var b=!a.noItems,d=!a.options.disableCreate&&a.isDefined(a.options.selectedItemText)&&""!==a.options.selectedItemText;g?a.options.isShowing=b||d:c(function(){g||(a.options.isShowing=!1)},100)};a.onFocused=function(a){g=a,h()};var i={reset:function(){a.highlightPos=0},next:function(){0<=a.highlightPos&&a.highlightPos<a.filteredItems.length-1?a.highlightPos++:this.reset()},back:function(){0===a.highlightPos?a.highlightPos=a.filteredItems.length-1:a.highlightPos>0&&a.highlightPos<a.filteredItems.length?a.highlightPos--:this.reset()},getHighlightedItem:function(){return 0<=a.highlightPos&&a.highlightPos<a.filteredItems.length?a.filteredItems[a.highlightPos]:a.filteredItems.length>0?a.filteredItems[0]:null}};i.reset();var j=function(a,b){return a.which&&a.which==b||a.keyCode&&a.keyCode==b};a.onKeyup=function(b){if(j(b,13)){var c=i.getHighlightedItem();null!==c?a.select(c):a.options.selectedItemText&&a.createAndSelect(a.options.selectedItemText)}else j(b,38)?i.back():j(b,40)&&i.next()}}]).directive("autocompleteInput",["$timeout",function(a){return{restrict:"E",replace:!0,scope:{selectedItem:"=",items:"=",userOptions:"=options"},controller:"AutocompleteInputController",templateUrl:"/assets/controls/autocomplete/autocompleteInput.html",link:function(b,c){var d=function(a){var c=$.extend({},{selectedItemText:"",propName:"name",isShowing:!1,placeholder:"",closeOnSelect:!0,disableCreate:!1},a);b.options=$.extend(a,c)};d(),b.$watch("userOptions",d);var e=c.find(".autocomplete-input");b.focusOnInput=function(){e.focus()},b.blur=function(){document.activeElement.blur(),a(function(){b.onFocused(!1)})},b.isDefined=function(a){return void 0!==a&&null!==a},b.isDefined(b.items)||(b.items=[]),b.createAndSelect=function(a){var c=b.create(a);b.select(c)},b.create=function(a){if(!b.options.disableCreate){if(b.isDefined(b.options.create))return b.options.create(a);var c={};return c[b.options.propName]=a,b.items.push(c),c}},b.select=function(a){b.isDefined(a)&&(b.isDefined(b.options.select)?b.options.select(a):(b.selectedItem=a,b.options.selectedItemText=b.isDefined(b.selectedItem)?b.selectedItem[b.options.propName]:""),b.onSelected(a))},b.onSelected=function(){b.options.closeOnSelect?b.blur():b.focusOnInput()}}}}]),angular.module("Helpers").directive("onFocusChanged",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e=function(b){a(b)},f=function(a){var c=b.$eval(d.onFocusChanged);angular.isDefined(c)&&e(function(){c(a)})};c.focusin(function(){f(!0)}),c.focusout(function(){f(!1)})}}}]),angular.module("Controls").controller("AutocompleteInputMultiController",["$scope","$timeout",function(a,b){var c=!1;a.$watch("selectedItemText.length",function(){c?e.reset():c=!0}),a.selectedItemPos=null,a.containerClicked=function(a){a.isDefaultPrevented()||e.reset()};var d=function(b){var c=a.getInput();b?c.focus():c.blur()},e={reset:function(){a.selectedItemPos=null,d(!0)},refreshCurrentSelection:function(){a.selectedItemPos<0||a.selectedItemPos>=a.selectedItems.length?this.reset():this.select(a.selectedItemPos)},next:function(){this.select(a.selectedItemPos+1)},back:function(){this.select(null===a.selectedItemPos?a.selectedItems.length-1:a.selectedItemPos-1)},select:function(b){var c=this,d=function(b){a.selectedItemPos=b,c.focusSelectedItem()};0>=b?a.selectedItems.length>0?d(0):c.reset():b===a.selectedItems.length?c.reset():b<a.selectedItems.length?d(b):c.reset()},isHighlightedItem:function(){return null!==a.selectedItemPos&&a.selectedItemPos>=0&&a.selectedItemPos<a.selectedItems.length},tryDeleteSelectedItem:function(){if(this.isHighlightedItem()){var b=a.selectedItems[a.selectedItemPos];return a.removeItem(b),this.refreshCurrentSelection(),!0}return!1},focusSelectedItem:function(){var c=this;d(!1),b(function(){if(c.isHighlightedItem()){var b=a.getHighlightedSelectedItem(),d=b.find(".aim-selected-item-btn-select");null!==d&&d.focus()}},0)}},f=function(a,b){return a.which&&a.which==b||a.keyCode&&a.keyCode==b};a.onKeyup=function(b){var c=a.getInput(),d=c.caret();f(b,37)?(0===d||e.isHighlightedItem())&&e.back():f(b,39)?(0===d||e.isHighlightedItem())&&e.next():f(b,8)?0===d&&(e.tryDeleteSelectedItem()||e.back()):f(b,46)&&e.tryDeleteSelectedItem()},a.highlightSelectedItem=function(a){e.select(a)}}]).directive("autocompleteInputMulti",["$timeout",function(){return{restrict:"E",replace:!0,scope:{selectedItems:"=",items:"=",userOptions:"=options"},controller:"AutocompleteInputMultiController",templateUrl:"/assets/controls/autocomplete/autocompleteInputMulti.html",link:function(a,b){var c=function(b){var c=$.extend({},{disableCreate:!1,closeOnSelect:!1,propName:"name",select:a.addItem},b);a.options=$.extend(b,c)};c(),a.$watch("userOptions",c);var d=null;if(a.getInput=function(){return null===d&&(d=b.find(".autocomplete-input"),0===d.length&&(d=null)),d},a.getHighlightedSelectedItem=function(){var a=b.find(".aim-selected-item.highlight");return 0===a.length?null:a},void 0===a.selectedItems||null===a.selectedItems)throw"Selected Items must be defined";if(void 0===a.items||null===a.items)throw"Items must be defined";var e=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)};a.addItem=function(b){a.selectedItems.push(b),a.options.selectedItemText="",e(a.availableItems,b)},a.removeItem=function(b){e(a.selectedItems,b),a.availableItems.push(b)};var f=function(){a.availableItems=a.items.slice(0),a.selectedItems.length=0};f()}}}]),angular.module("Helpers").directive("preventDefault",function(){return function(a,b){b.click(function(a){a.preventDefault()})}});