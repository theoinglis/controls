angular.module("Controls").controller("AutocompleteInputController",["$scope","$filter","$timeout",function(a,b,c){var d=b("filter"),e=b("orderBy"),f=function(){a.filteredItems=e(d(a.items,a.options.selectedItemText),a.options.propName),a.noItems=0===a.filteredItems.length,h()};a.$watch("options.selectedItemText.length",function(){a.isDefined(a.options.selectedItem)&&a.options.selectedItemText===a.selectedItem[a.options.propName]||(a.selectedItem={}),f()}),a.$watch("items.length",f);var g,h=function(){var b=!a.noItems,d=!a.options.disableCreate&&a.isDefined(a.options.selectedItemText)&&""!==a.options.selectedItemText;g?a.options.isShowing=b||d:c(function(){g||(a.options.isShowing=!1)},100)};a.onFocused=function(a){g=a,h()};var i={reset:function(){a.highlightPos=0},next:function(){0<=a.highlightPos&&a.highlightPos<a.filteredItems.length-1?a.highlightPos++:this.reset()},back:function(){0===a.highlightPos?a.highlightPos=a.filteredItems.length-1:a.highlightPos>0&&a.highlightPos<a.filteredItems.length?a.highlightPos--:this.reset()},getHighlightedItem:function(){return 0<=a.highlightPos&&a.highlightPos<a.filteredItems.length?a.filteredItems[a.highlightPos]:a.filteredItems.length>0?a.filteredItems[0]:null}};i.reset();var j=function(a,b){return a.which&&a.which==b||a.keyCode&&a.keyCode==b};a.onKeyup=function(b){if(j(b,13)){var c=i.getHighlightedItem();null!==c?a.select(c):a.options.selectedItemText&&a.createAndSelect(a.options.selectedItemText)}else j(b,38)?i.back():j(b,40)&&i.next()}}]).directive("autocompleteInput",["$timeout",function(a){return{restrict:"E",replace:!0,scope:{selectedItem:"=",items:"=",userOptions:"=options"},controller:"AutocompleteInputController",templateUrl:"/assets/controls/autocomplete/autocompleteInput.html",link:function(b,c){var d=function(a){var c=$.extend({},{selectedItemText:"",propName:"name",isShowing:!1,placeholder:"",closeOnSelect:!0,disableCreate:!1},a);b.options=$.extend(a,c)};d(),b.$watch("userOptions",d);var e=c.find(".autocomplete-input");b.focusOnInput=function(){e.focus()},b.blur=function(){document.activeElement.blur(),a(function(){b.onFocused(!1)})},b.isDefined=function(a){return void 0!==a&&null!==a},b.isDefined(b.items)||(b.items=[]),b.createAndSelect=function(a){var c=b.create(a);b.select(c)},b.create=function(a){if(!b.options.disableCreate){if(b.isDefined(b.options.create))return b.options.create(a);var c={};return c[b.options.propName]=a,b.items.push(c),c}},b.select=function(a){b.isDefined(a)&&(b.isDefined(b.options.select)?b.options.select(a):(b.selectedItem=a,b.options.selectedItemText=b.isDefined(b.selectedItem)?b.selectedItem[b.options.propName]:""),b.onSelected(a))},b.onSelected=function(){b.options.closeOnSelect?b.blur():b.focusOnInput()}}}}]),angular.module("Helpers").directive("onFocusChanged",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e=function(b){a(b)},f=function(a){var c=b.$eval(d.onFocusChanged);angular.isDefined(c)&&e(function(){c(a)})};c.focusin(function(){f(!0)}),c.focusout(function(){f(!1)})}}}]),angular.module("Helpers").directive("preventDefault",function(){return function(a,b){b.click(function(a){a.preventDefault()})}});